# terraci summary

–ü—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã terraform plan –≤ –≤–∏–¥–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ GitLab Merge Request.

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```bash
terraci summary [flags]
```

## –û–ø–∏—Å–∞–Ω–∏–µ

–ö–æ–º–∞–Ω–¥–∞ `summary` —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã terraform plan –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ —Å–æ–∑–¥–∞—ë—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –æ–±–∑–æ—Ä–æ–º –≤ merge request GitLab.

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–∂–æ–± –≤ GitLab CI –ø–∞–π–ø–ª–∞–π–Ω–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö plan-–¥–∂–æ–±–æ–≤. –û–Ω–∞ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã `plan.txt` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö –º–æ–¥—É–ª–µ–π –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ MR.

–ö–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∑–∞–ø—É—â–µ–Ω–∞ –ª–∏ –æ–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ MR –ø–∞–π–ø–ª–∞–π–Ω–∞, –∏ —Å–æ–∑–¥–∞—ë—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ summary-–¥–∂–æ–±–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞:

```yaml
terraci-summary:
  stage: summary
  image: ghcr.io/edelwud/terraci:latest
  script:
    - terraci summary
  needs:
    - job: plan-platform-stage-eu-central-1-vpc
      optional: true
  rules:
    - if: $CI_MERGE_REQUEST_IID
      when: always
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ |
|------------|----------|-------------|
| `CI_MERGE_REQUEST_IID` | –ù–æ–º–µ—Ä MR (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è GitLab –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) | –î–∞ |
| `CI_PROJECT_ID` | ID –ø—Ä–æ–µ–∫—Ç–∞ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) | –î–∞ |
| `CI_SERVER_URL` | URL —Å–µ—Ä–≤–µ—Ä–∞ GitLab (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) | –î–∞ |
| `GITLAB_TOKEN` | API —Ç–æ–∫–µ–Ω –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ | –ù–µ—Ç* |
| `CI_JOB_TOKEN` | –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ç–æ–∫–µ–Ω (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) | –ù–µ—Ç* |

*–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏–±–æ `GITLAB_TOKEN`, –ª–∏–±–æ `CI_JOB_TOKEN`.

## –í—ã–≤–æ–¥

–ö–æ–º–∞–Ω–¥–∞ –ø—É–±–ª–∏–∫—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞ –≤ MR:

```markdown
## üîÑ Terraform Plan Summary

| –ú–æ–¥—É–ª—å | –°—Ç–∞—Ç—É—Å | –°–≤–æ–¥–∫–∞ |
|--------|--------|--------|
| `platform/stage/eu-central-1/vpc` | ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è | Plan: 2 to add, 1 to change, 0 to destroy |
| `platform/stage/eu-central-1/eks` | ‚ûñ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π | Infrastructure is up-to-date |

<details>
<summary>üìã platform/stage/eu-central-1/vpc</summary>

Plan: 2 to add, 1 to change, 0 to destroy.
...

</details>
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ summary-–¥–∂–æ–± —á–µ—Ä–µ–∑ `.terraci.yaml`:

```yaml
gitlab:
  mr:
    comment:
      enabled: true
      on_changes_only: false
      include_details: true
    summary_job:
      image:
        name: "ghcr.io/edelwud/terraci:latest"
      tags:
        - docker
```

–ü–æ–ª–Ω—ã–µ –æ–ø—Ü–∏–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitLab MR](/ru/config/gitlab-mr).

## –ö–æ–¥—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 0 | –£—Å–ø–µ—Ö (–∏–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω–æ, –µ—Å–ª–∏ –Ω–µ –≤ MR) |
| 1 | –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–ª–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è |

## –ü—Ä–∏–º–µ—Ä—ã

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export CI_MERGE_REQUEST_IID=42
export CI_PROJECT_ID=12345
export GITLAB_TOKEN=your-token

terraci summary
```

### –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

```bash
terraci summary -v
```

## –°–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ

- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitLab MR](/ru/config/gitlab-mr)
- [terraci generate](/ru/cli/generate)
